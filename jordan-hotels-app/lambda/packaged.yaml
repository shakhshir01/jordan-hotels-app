AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: "VisitJo SAM template \u2014 API, Lambdas, DynamoDB, S3, Secrets Manager\
  \ (updated)"
Globals:
  Function:
    Runtime: nodejs20.x
    Timeout: 10
    MemorySize: 512
    Environment:
      Variables:
        AWS_NODEJS_CONNECTION_REUSE_ENABLED: '1'
Parameters:
  OpenAISecretArn:
    Type: String
    Description: 'ARN or name of the Secrets Manager secret containing OPENAI_API_KEY
      (SecretString key: OPENAI_API_KEY). Leave empty to set at deploy time.'
    Default: ''
  StripeSecretArn:
    Type: String
    Description: ARN of an existing Stripe Secrets Manager secret. Leave empty to
      create a new secret.
    Default: ''
Conditions:
  CreateStripeSecret:
    Fn::Equals:
    - Ref: StripeSecretArn
    - ''
Resources:
  Api:
    Type: AWS::Serverless::Api
    Properties:
      StageName: prod
      EndpointConfiguration: REGIONAL
      Cors:
        AllowMethods: '''GET,POST,PUT,DELETE,OPTIONS'''
        AllowHeaders: '''Authorization,Content-Type,X-Api-Key,X-Amz-Date,X-Amz-Security-Token,X-Amz-User-Agent'''
        AllowOrigin: '''*'''
        AllowCredentials: false
      Tags:
        App: VisitJo
        ManagedBy: SAM
        Stack:
          Ref: AWS::StackName
    Metadata:
      SamResourceId: Api
  GatewayResponseDefault4xx:
    Type: AWS::ApiGateway::GatewayResponse
    Properties:
      RestApiId:
        Ref: Api
      ResponseType: DEFAULT_4XX
      StatusCode: 400
      ResponseParameters:
        gatewayresponse.header.Access-Control-Allow-Origin: '''*'''
        gatewayresponse.header.Access-Control-Allow-Headers: '''Authorization,Content-Type,X-Api-Key,X-Amz-Date,X-Amz-Security-Token,X-Amz-User-Agent'''
        gatewayresponse.header.Access-Control-Allow-Methods: '''GET,POST,PUT,DELETE,OPTIONS'''
    Metadata:
      SamResourceId: GatewayResponseDefault4xx
  GatewayResponseDefault5xx:
    Type: AWS::ApiGateway::GatewayResponse
    Properties:
      RestApiId:
        Ref: Api
      ResponseType: DEFAULT_5XX
      StatusCode: 500
      ResponseParameters:
        gatewayresponse.header.Access-Control-Allow-Origin: '''*'''
        gatewayresponse.header.Access-Control-Allow-Headers: '''Authorization,Content-Type,X-Api-Key,X-Amz-Date,X-Amz-Security-Token,X-Amz-User-Agent'''
        gatewayresponse.header.Access-Control-Allow-Methods: '''GET,POST,PUT,DELETE,OPTIONS'''
    Metadata:
      SamResourceId: GatewayResponseDefault5xx
  GatewayResponseUnauthorized:
    Type: AWS::ApiGateway::GatewayResponse
    Properties:
      RestApiId:
        Ref: Api
      ResponseType: UNAUTHORIZED
      StatusCode: 401
      ResponseParameters:
        gatewayresponse.header.Access-Control-Allow-Origin: '''*'''
        gatewayresponse.header.Access-Control-Allow-Headers: '''Authorization,Content-Type,X-Api-Key,X-Amz-Date,X-Amz-Security-Token,X-Amz-User-Agent'''
        gatewayresponse.header.Access-Control-Allow-Methods: '''GET,POST,PUT,DELETE,OPTIONS'''
    Metadata:
      SamResourceId: GatewayResponseUnauthorized
  GatewayResponseAccessDenied:
    Type: AWS::ApiGateway::GatewayResponse
    Properties:
      RestApiId:
        Ref: Api
      ResponseType: ACCESS_DENIED
      StatusCode: 403
      ResponseParameters:
        gatewayresponse.header.Access-Control-Allow-Origin: '''*'''
        gatewayresponse.header.Access-Control-Allow-Headers: '''Authorization,Content-Type,X-Api-Key,X-Amz-Date,X-Amz-Security-Token,X-Amz-User-Agent'''
        gatewayresponse.header.Access-Control-Allow-Methods: '''GET,POST,PUT,DELETE,OPTIONS'''
    Metadata:
      SamResourceId: GatewayResponseAccessDenied
  HotelsTable:
    Type: AWS::DynamoDB::Table
    DeletionPolicy: Retain
    UpdateReplacePolicy: Retain
    Properties:
      AttributeDefinitions:
      - AttributeName: id
        AttributeType: S
      KeySchema:
      - AttributeName: id
        KeyType: HASH
      BillingMode: PAY_PER_REQUEST
      SSESpecification:
        SSEEnabled: true
      Tags:
      - Key: App
        Value: VisitJo
      - Key: ManagedBy
        Value: SAM
      - Key: Stack
        Value:
          Ref: AWS::StackName
    Metadata:
      SamResourceId: HotelsTable
  DestinationsTable:
    Type: AWS::DynamoDB::Table
    DeletionPolicy: Retain
    UpdateReplacePolicy: Retain
    Properties:
      AttributeDefinitions:
      - AttributeName: id
        AttributeType: S
      KeySchema:
      - AttributeName: id
        KeyType: HASH
      BillingMode: PAY_PER_REQUEST
      SSESpecification:
        SSEEnabled: true
      Tags:
      - Key: App
        Value: VisitJo
      - Key: ManagedBy
        Value: SAM
      - Key: Stack
        Value:
          Ref: AWS::StackName
    Metadata:
      SamResourceId: DestinationsTable
  DealsTable:
    Type: AWS::DynamoDB::Table
    DeletionPolicy: Retain
    UpdateReplacePolicy: Retain
    Properties:
      AttributeDefinitions:
      - AttributeName: id
        AttributeType: S
      KeySchema:
      - AttributeName: id
        KeyType: HASH
      BillingMode: PAY_PER_REQUEST
      SSESpecification:
        SSEEnabled: true
      Tags:
      - Key: App
        Value: VisitJo
      - Key: ManagedBy
        Value: SAM
      - Key: Stack
        Value:
          Ref: AWS::StackName
    Metadata:
      SamResourceId: DealsTable
  ExperiencesTable:
    Type: AWS::DynamoDB::Table
    DeletionPolicy: Retain
    UpdateReplacePolicy: Retain
    Properties:
      AttributeDefinitions:
      - AttributeName: id
        AttributeType: S
      KeySchema:
      - AttributeName: id
        KeyType: HASH
      BillingMode: PAY_PER_REQUEST
      SSESpecification:
        SSEEnabled: true
      Tags:
      - Key: App
        Value: VisitJo
      - Key: ManagedBy
        Value: SAM
      - Key: Stack
        Value:
          Ref: AWS::StackName
    Metadata:
      SamResourceId: ExperiencesTable
  BookingsTable:
    Type: AWS::DynamoDB::Table
    DeletionPolicy: Retain
    UpdateReplacePolicy: Retain
    Properties:
      AttributeDefinitions:
      - AttributeName: id
        AttributeType: S
      - AttributeName: userId
        AttributeType: S
      KeySchema:
      - AttributeName: id
        KeyType: HASH
      GlobalSecondaryIndexes:
      - IndexName: UserIdIndex
        KeySchema:
        - AttributeName: userId
          KeyType: HASH
        Projection:
          ProjectionType: ALL
      BillingMode: PAY_PER_REQUEST
      SSESpecification:
        SSEEnabled: true
      Tags:
      - Key: App
        Value: VisitJo
      - Key: ManagedBy
        Value: SAM
      - Key: Stack
        Value:
          Ref: AWS::StackName
    Metadata:
      SamResourceId: BookingsTable
  UsersTable:
    Type: AWS::DynamoDB::Table
    DeletionPolicy: Retain
    UpdateReplacePolicy: Retain
    Properties:
      AttributeDefinitions:
      - AttributeName: userId
        AttributeType: S
      KeySchema:
      - AttributeName: userId
        KeyType: HASH
      BillingMode: PAY_PER_REQUEST
      SSESpecification:
        SSEEnabled: true
      Tags:
      - Key: App
        Value: VisitJo
      - Key: ManagedBy
        Value: SAM
      - Key: Stack
        Value:
          Ref: AWS::StackName
    Metadata:
      SamResourceId: UsersTable
  LogsBucket:
    Type: AWS::S3::Bucket
    DeletionPolicy: Retain
    UpdateReplacePolicy: Retain
    Properties:
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true
      VersioningConfiguration:
        Status: Enabled
      BucketEncryption:
        ServerSideEncryptionConfiguration:
        - ServerSideEncryptionByDefault:
            SSEAlgorithm: AES256
      Tags:
      - Key: App
        Value: VisitJo
      - Key: ManagedBy
        Value: SAM
      - Key: Stack
        Value:
          Ref: AWS::StackName
    Metadata:
      SamResourceId: LogsBucket
  UploadsBucket:
    Type: AWS::S3::Bucket
    DeletionPolicy: Retain
    UpdateReplacePolicy: Retain
    Properties:
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true
      VersioningConfiguration:
        Status: Enabled
      BucketEncryption:
        ServerSideEncryptionConfiguration:
        - ServerSideEncryptionByDefault:
            SSEAlgorithm: AES256
      LoggingConfiguration:
        DestinationBucketName:
          Ref: LogsBucket
        LogFilePrefix: access-logs/
      Tags:
      - Key: App
        Value: VisitJo
      - Key: ManagedBy
        Value: SAM
      - Key: Stack
        Value:
          Ref: AWS::StackName
    Metadata:
      SamResourceId: UploadsBucket
  StripeSecret:
    Condition: CreateStripeSecret
    Type: AWS::SecretsManager::Secret
    DeletionPolicy: Retain
    UpdateReplacePolicy: Retain
    Properties:
      Description: Stripe secret for VisitJo (store STRIPE_SECRET here)
      KmsKeyId: alias/aws/secretsmanager
      Tags:
      - Key: App
        Value: VisitJo
      - Key: ManagedBy
        Value: SAM
      - Key: Stack
        Value:
          Ref: AWS::StackName
    Metadata:
      SamResourceId: StripeSecret
  LambdaRolePolicy:
    Type: AWS::IAM::ManagedPolicy
    Properties:
      PolicyDocument:
        Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Action:
          - dynamodb:Query
          - dynamodb:Scan
          - dynamodb:GetItem
          - dynamodb:PutItem
          - dynamodb:UpdateItem
          Resource: '*'
        - Effect: Allow
          Action:
          - s3:PutObject
          - s3:GetObject
          - s3:PutObjectAcl
          Resource:
            Fn::Sub: arn:aws:s3:::${UploadsBucket}/*
        - Effect: Allow
          Action:
          - ses:SendEmail
          - ses:SendRawEmail
          Resource: '*'
        - Effect: Allow
          Action:
          - secretsmanager:GetSecretValue
          Resource:
            Fn::Sub: arn:aws:secretsmanager:${AWS::Region}:${AWS::AccountId}:secret:*stripe*
    Metadata:
      SamResourceId: LambdaRolePolicy
  GetHotelsFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: getHotels/index.handler
      CodeUri: s3://visitjo-sam-deploy-20260116230619/f0f5ab5c91d70789097863aa3eb1f85e
      Tags:
        App: VisitJo
        ManagedBy: SAM
        Stack:
          Ref: AWS::StackName
      Policies:
      - AWSLambdaBasicExecutionRole
      - Ref: LambdaRolePolicy
      Environment:
        Variables:
          HOTELS_TABLE:
            Ref: HotelsTable
      Events:
        ApiGetHotels:
          Type: Api
          Properties:
            Path: /hotels
            Method: GET
            RestApiId:
              Ref: Api
    Metadata:
      SamResourceId: GetHotelsFunction
  GetHotelByIdFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: getHotelById/index.handler
      CodeUri: s3://visitjo-sam-deploy-20260116230619/475337edfbd1058027ef1a781a9447ef
      Tags:
        App: VisitJo
        ManagedBy: SAM
        Stack:
          Ref: AWS::StackName
      Policies:
      - AWSLambdaBasicExecutionRole
      - Ref: LambdaRolePolicy
      Environment:
        Variables:
          HOTELS_TABLE:
            Ref: HotelsTable
      Events:
        ApiGetHotelById:
          Type: Api
          Properties:
            Path: /hotels/{id}
            Method: GET
            RestApiId:
              Ref: Api
    Metadata:
      SamResourceId: GetHotelByIdFunction
  SearchFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: search/index.handler
      CodeUri: s3://visitjo-sam-deploy-20260116230619/8e79f7ec09548c8fc0721d2a20471c34
      Tags:
        App: VisitJo
        ManagedBy: SAM
        Stack:
          Ref: AWS::StackName
      Policies:
      - AWSLambdaBasicExecutionRole
      - Ref: LambdaRolePolicy
      Environment:
        Variables:
          HOTELS_TABLE:
            Ref: HotelsTable
          DESTINATIONS_TABLE:
            Ref: DestinationsTable
          DEALS_TABLE:
            Ref: DealsTable
          EXPERIENCES_TABLE:
            Ref: ExperiencesTable
      Events:
        ApiSearch:
          Type: Api
          Properties:
            Path: /search
            Method: GET
            RestApiId:
              Ref: Api
    Metadata:
      SamResourceId: SearchFunction
  DestinationsFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: destinations/index.handler
      CodeUri: s3://visitjo-sam-deploy-20260116230619/97f5f211b1334948e3bf6c29d94a0ed3
      Tags:
        App: VisitJo
        ManagedBy: SAM
        Stack:
          Ref: AWS::StackName
      Policies:
      - AWSLambdaBasicExecutionRole
      - Ref: LambdaRolePolicy
      Environment:
        Variables:
          DESTINATIONS_TABLE:
            Ref: DestinationsTable
      Events:
        ApiDestinations:
          Type: Api
          Properties:
            Path: /destinations
            Method: GET
            RestApiId:
              Ref: Api
        ApiDestinationById:
          Type: Api
          Properties:
            Path: /destinations/{id}
            Method: GET
            RestApiId:
              Ref: Api
    Metadata:
      SamResourceId: DestinationsFunction
  DealsFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: deals/index.handler
      CodeUri: s3://visitjo-sam-deploy-20260116230619/110075bff5dbb9dcb3c931e0a8570d64
      Tags:
        App: VisitJo
        ManagedBy: SAM
        Stack:
          Ref: AWS::StackName
      Policies:
      - AWSLambdaBasicExecutionRole
      - Ref: LambdaRolePolicy
      Environment:
        Variables:
          DEALS_TABLE:
            Ref: DealsTable
      Events:
        ApiDeals:
          Type: Api
          Properties:
            Path: /deals
            Method: GET
            RestApiId:
              Ref: Api
        ApiDealById:
          Type: Api
          Properties:
            Path: /deals/{id}
            Method: GET
            RestApiId:
              Ref: Api
    Metadata:
      SamResourceId: DealsFunction
  ExperiencesFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: experiences/index.handler
      CodeUri: s3://visitjo-sam-deploy-20260116230619/8e002d6c23792dfa456c20f03b78324a
      Tags:
        App: VisitJo
        ManagedBy: SAM
        Stack:
          Ref: AWS::StackName
      Policies:
      - AWSLambdaBasicExecutionRole
      - Ref: LambdaRolePolicy
      Environment:
        Variables:
          EXPERIENCES_TABLE:
            Ref: ExperiencesTable
      Events:
        ApiExperiences:
          Type: Api
          Properties:
            Path: /experiences
            Method: GET
            RestApiId:
              Ref: Api
        ApiExperienceById:
          Type: Api
          Properties:
            Path: /experiences/{id}
            Method: GET
            RestApiId:
              Ref: Api
    Metadata:
      SamResourceId: ExperiencesFunction
  BookingsFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: bookings/index.handler
      CodeUri: s3://visitjo-sam-deploy-20260116230619/8d659bb054f69cc2900c92019f291f8f
      Tags:
        App: VisitJo
        ManagedBy: SAM
        Stack:
          Ref: AWS::StackName
      Policies:
      - AWSLambdaBasicExecutionRole
      - Ref: LambdaRolePolicy
      Environment:
        Variables:
          BOOKINGS_TABLE:
            Ref: BookingsTable
      Events:
        ApiBookings:
          Type: Api
          Properties:
            Path: /bookings
            Method: ANY
            RestApiId:
              Ref: Api
    Metadata:
      SamResourceId: BookingsFunction
  CreateCheckoutSessionFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: createCheckoutSession/index.handler
      CodeUri: s3://visitjo-sam-deploy-20260116230619/9cca75dcbeede759897bc1cfa359e769
      Tags:
        App: VisitJo
        ManagedBy: SAM
        Stack:
          Ref: AWS::StackName
      Policies:
      - AWSLambdaBasicExecutionRole
      - Ref: LambdaRolePolicy
      Environment:
        Variables:
          STRIPE_SECRET_ARN:
            Fn::If:
            - CreateStripeSecret
            - Ref: StripeSecret
            - Ref: StripeSecretArn
          PAYMENTS_ENABLED: 'true'
          ALLOW_LIVE_PAYMENTS: 'false'
      Events:
        ApiCheckout:
          Type: Api
          Properties:
            Path: /payments/create-checkout-session
            Method: POST
            RestApiId:
              Ref: Api
    Metadata:
      SamResourceId: CreateCheckoutSessionFunction
  CreatePaymentIntentFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: createPaymentIntent/index.handler
      CodeUri: s3://visitjo-sam-deploy-20260116230619/14d1668ea3af7ed6186ad8f77ee5f228
      Tags:
        App: VisitJo
        ManagedBy: SAM
        Stack:
          Ref: AWS::StackName
      Policies:
      - AWSLambdaBasicExecutionRole
      - Ref: LambdaRolePolicy
      Environment:
        Variables:
          STRIPE_SECRET_ARN:
            Fn::If:
            - CreateStripeSecret
            - Ref: StripeSecret
            - Ref: StripeSecretArn
          PAYMENTS_ENABLED: 'true'
          ALLOW_LIVE_PAYMENTS: 'false'
      Events:
        ApiCreateIntent:
          Type: Api
          Properties:
            Path: /payments/create-intent
            Method: POST
            RestApiId:
              Ref: Api
    Metadata:
      SamResourceId: CreatePaymentIntentFunction
  GetSignedUrlFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: getSignedUrl/index.handler
      CodeUri: s3://visitjo-sam-deploy-20260116230619/f97f40cd31d954aaba57ece826453ef6
      Tags:
        App: VisitJo
        ManagedBy: SAM
        Stack:
          Ref: AWS::StackName
      Policies:
      - AWSLambdaBasicExecutionRole
      - Ref: LambdaRolePolicy
      Environment:
        Variables:
          S3_UPLOAD_BUCKET:
            Ref: UploadsBucket
      Events:
        ApiSignedUrl:
          Type: Api
          Properties:
            Path: /uploads/signed-url
            Method: POST
            RestApiId:
              Ref: Api
    Metadata:
      SamResourceId: GetSignedUrlFunction
  UserFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: user/index.handler
      CodeUri: s3://visitjo-sam-deploy-20260116230619/e4a87ff131b3ef0d53c7ac8cefe50a45
      Tags:
        App: VisitJo
        ManagedBy: SAM
        Stack:
          Ref: AWS::StackName
      Policies:
      - AWSLambdaBasicExecutionRole
      - Ref: LambdaRolePolicy
      Environment:
        Variables:
          BOOKINGS_TABLE:
            Ref: BookingsTable
          USERS_TABLE:
            Ref: UsersTable
          SES_EMAIL_FROM: no-reply@visit-jo.com
          SES_FROM_EMAIL: no-reply@visit-jo.com
          DOMAIN: visit-jo.com
      Events:
        ApiUserProfileGet:
          Type: Api
          Properties:
            Path: /user/profile
            Method: GET
            RestApiId:
              Ref: Api
        ApiUserProfilePut:
          Type: Api
          Properties:
            Path: /user/profile
            Method: PUT
            RestApiId:
              Ref: Api
        ApiUserBookings:
          Type: Api
          Properties:
            Path: /user/bookings
            Method: GET
            RestApiId:
              Ref: Api
        ApiUserMfaEmailSetup:
          Type: Api
          Properties:
            Path: /user/mfa/email/setup
            Method: POST
            RestApiId:
              Ref: Api
        ApiUserMfaEmailVerify:
          Type: Api
          Properties:
            Path: /user/mfa/email/verify
            Method: POST
            RestApiId:
              Ref: Api
        ApiUserMfaTotpSetup:
          Type: Api
          Properties:
            Path: /user/mfa/totp/setup
            Method: POST
            RestApiId:
              Ref: Api
        ApiUserMfaTotpVerify:
          Type: Api
          Properties:
            Path: /user/mfa/totp/verify
            Method: POST
            RestApiId:
              Ref: Api
        ApiAuthEmailMfaRequest:
          Type: Api
          Properties:
            Path: /auth/email-mfa/request
            Method: POST
            RestApiId:
              Ref: Api
        ApiAuthEmailMfaSetup:
          Type: Api
          Properties:
            Path: /auth/email-mfa/setup
            Method: POST
            RestApiId:
              Ref: Api
        ApiAuthEmailMfaVerifyLogin:
          Type: Api
          Properties:
            Path: /auth/email-mfa/verify-login
            Method: POST
            RestApiId:
              Ref: Api
        ApiAuthTotpVerifyLogin:
          Type: Api
          Properties:
            Path: /auth/totp/verify-login
            Method: POST
            RestApiId:
              Ref: Api
        ApiUserMfaDisable:
          Type: Api
          Properties:
            Path: /user/mfa/disable
            Method: POST
            RestApiId:
              Ref: Api
        ApiUserMfaDisableByEmail:
          Type: Api
          Properties:
            Path: /user/mfa/disable-by-email
            Method: POST
            RestApiId:
              Ref: Api
    Metadata:
      SamResourceId: UserFunction
  SendBookingEmailFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: sendBookingEmail/index.handler
      CodeUri: s3://visitjo-sam-deploy-20260116230619/37b0f5625bf530568f0f85f714fb8334
      Tags:
        App: VisitJo
        ManagedBy: SAM
        Stack:
          Ref: AWS::StackName
      Policies:
      - AWSLambdaBasicExecutionRole
      - Ref: LambdaRolePolicy
      Environment:
        Variables:
          SES_EMAIL_FROM: no-reply@visit-jo.com
          SES_FROM_EMAIL: no-reply@visit-jo.com
          FRONTEND_URL: https://main.d1ewsonl19kjj7.amplifyapp.com
      Events:
        ApiSendBookingEmail:
          Type: Api
          Properties:
            Path: /send-booking-email
            Method: POST
            RestApiId:
              Ref: Api
    Metadata:
      SamResourceId: SendBookingEmailFunction
  ChatFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: chat/index.handler
      CodeUri: s3://visitjo-sam-deploy-20260116230619/1dac242fcf5961ad9e137968e9975b0d
      Tags:
        App: VisitJo
        ManagedBy: SAM
        Stack:
          Ref: AWS::StackName
      Policies:
      - AWSLambdaBasicExecutionRole
      - Ref: LambdaRolePolicy
      Environment:
        Variables:
          OPENAI_API_KEY: ''
      Events:
        ApiChat:
          Type: Api
          Properties:
            Path: /chat
            Method: POST
            RestApiId:
              Ref: Api
    Metadata:
      SamResourceId: ChatFunction
Outputs:
  ApiUrl:
    Description: Base URL for API
    Value:
      Fn::Sub: https://${Api}.execute-api.${AWS::Region}.amazonaws.com/prod
    Export:
      Name:
        Fn::Sub: ${AWS::StackName}-ApiUrl
